# 구구단 산성비 게임 PRD (Product Requirements Document)

## 1. 제품 개요

### 1.1 제품명
**구구단 산성비 게임 (Multiplication Rain)**

### 1.2 목적
초등학교 2학년 학생들이 곱셈구구를 재미있게 학습하고 연습할 수 있도록 게임화된 학습 도구를 제공합니다. 온라인 멀티플레이어 기능을 통해 친구들과 함께 경쟁하며 학습할 수 있는 환경을 제공합니다.

### 1.3 타겟 사용자
- 주 사용자: 초등학교 2학년 학생 (7-8세)
- 부 사용자: 학부모, 교사

### 1.4 핵심 가치
- 반복 학습을 통한 곱셈구구 암기 강화
- 게임을 통한 학습 동기 부여
- 실시간 피드백으로 학습 효과 극대화
- 멀티플레이어를 통한 협업 및 경쟁 학습
- 온라인 리더보드를 통한 지속적인 동기 부여

---

## 2. 게임 메커니즘

### 2.1 게임 플레이 방식
1. 화면 상단에서 곱셈 문제가 적힌 물방울(또는 운석)이 떨어짐
2. 학생은 화면 하단의 숫자 버튼을 클릭하여 정답 입력
3. 정답을 맞추면 해당 물방울이 사라지고 점수 획득
4. 오답이거나 물방울이 바닥에 닿으면 생명력 감소
5. 생명력이 모두 소진되면 게임 종료

### 2.2 난이도 설정
- **쉬움**: 2단, 3단, 5단만 출제 / 떨어지는 속도 느림 / 동시 물방울 개수 1-2개
- **보통**: 2단~5단 출제 / 떨어지는 속도 보통 / 동시 물방울 개수 2-3개
- **어려움**: 2단~9단 출제 / 떨어지는 속도 빠름 / 동시 물방울 개수 3-4개
- **커스텀**: 원하는 단수 선택 가능

### 2.3 점수 시스템
- 정답 1개당 기본 점수: 10점
- 연속 정답 보너스: 5연속(+50점), 10연속(+100점), 20연속(+200점)
- 빠른 정답 보너스: 물방울이 상단 30% 영역에 있을 때 맞추면 +5점
- 최종 점수에 따른 등급: ⭐(0-100), ⭐⭐(101-300), ⭐⭐⭐(301-500), ⭐⭐⭐⭐(501-700), ⭐⭐⭐⭐⭐(701+)

### 2.4 멀티플레이어 모드
- **방 생성**: 사용자가 게임 방을 생성하면 고유한 방 코드(6자리 영숫자)가 자동 생성됨
- **방 참여**: 다른 사용자가 방 코드를 입력하여 같은 방에 참여 가능
- **동시 플레이**: 같은 방의 모든 참여자가 동일한 문제를 풀며 각자의 점수를 획득
- **실시간 동기화**: 모든 참여자의 점수와 상태가 실시간으로 업데이트됨
- **방별 기록**: 게임 종료 시 방별로 참여자 목록과 각자의 점수가 기록됨
- **최대 참여 인원**: 방당 최대 10명까지 참여 가능

---

## 3. 화면 구성

### 3.1 메인 화면
- 게임 제목 및 로고
- **사용자 인증 상태 표시**
  - 로그인된 경우: 닉네임 표시 및 [로그아웃] 버튼
  - 로그인 안 된 경우: [로그인] / [회원가입] 버튼
- 시작하기 버튼 (싱글 플레이)
- 멀티플레이어 버튼
  - 방 만들기
  - 방 참여하기 (코드 입력)
- 리더보드 버튼 (클릭 시 리더보드 화면으로 이동)
- 최고 점수 표시 (로그인된 경우에만 표시)
- 설정 버튼 (사운드 on/off)

### 3.2 회원가입 화면
- 제목: "회원가입"
- 입력 필드:
  - 이름 (닉네임): 텍스트 입력 (최소 2자, 최대 20자)
  - 비밀번호: 비밀번호 입력 (최소 6자)
  - 비밀번호 확인: 비밀번호 재입력
- [회원가입] 버튼
- [뒤로가기] 버튼 (메인 화면으로)
- [이미 계정이 있으신가요? 로그인] 링크

### 3.3 로그인 화면
- 제목: "로그인"
- 입력 필드:
  - 이름 (닉네임): 텍스트 입력
  - 비밀번호: 비밀번호 입력
- [로그인] 버튼
- [뒤로가기] 버튼 (메인 화면으로)
- [계정이 없으신가요? 회원가입] 링크

### 3.4 리더보드 화면
- 탭 메뉴: [전체] [주간] [월간]
- 각 탭별 상위 10명 표시
  - 순위, 닉네임, 점수, 등급 표시
- 개인 최고 기록 표시 (하단)
- [뒤로가기] 버튼 (메인 화면으로 복귀)

### 3.5 난이도 선택 화면
- 쉬움 / 보통 / 어려움 / 커스텀 버튼
- 각 난이도별 설명 표시
- 커스텀 모드: 2~9단 중 원하는 단수 체크박스 선택

### 3.6 게임 화면
```
┌─────────────────────────────────────┐
│ ❤️❤️❤️  점수: 120  최고점수: 450  │
│                                     │
│         [3 × 4]  💧               │
│                                     │
│              💧 [7 × 2]            │
│                                     │
│                                     │
│  [5 × 5]  💧                       │
│                                     │
│                                     │
│─────────────────────────────────────│
│                                     │
│  현재 문제: 3 × 4 = ?               │
│                                     │
│  [0] [1] [2] [3] [4] [5] [6] [7]   │
│  [8] [9] [10] [12] [14] [15] ...   │
│  [18] [20] [21] [24] [25] ...      │
│                                     │
└─────────────────────────────────────┘
```

### 3.7 멀티플레이어 방 화면
```
┌─────────────────────────────────────┐
│ 방 코드: ABC123  참여자: 3/10      │
│                                     │
│ 참여자 목록:                        │
│ 👤 플레이어1  점수: 250            │
│ 👤 플레이어2  점수: 180            │
│ 👤 플레이어3  점수: 320            │
│                                     │
│ [게임 시작] 버튼 (방장만)          │
└─────────────────────────────────────┘
```

### 3.8 멀티플레이어 게임 화면
- 싱글 플레이 화면과 동일한 구조
- 추가 요소:
  - 실시간 참여자 점수 표시 (화면 상단 또는 측면)
  - 현재 1등 플레이어 하이라이트
  - 방 코드 표시 (게임 중에도 확인 가능)

### 3.9 게임 오버 화면
- 최종 점수 및 등급 표시
- 맞춘 문제 수 / 전체 문제 수
- 정답률 표시
- **멀티플레이어 모드인 경우**:
  - 방 내 순위 표시
  - 모든 참여자의 최종 점수 비교
  - 승리자 하이라이트
- 다시하기 버튼
- 메인으로 버튼
- 결과 공유하기 버튼 (선택사항)

---

## 4. 주요 기능 요구사항

### 4.1 필수 기능 (MVP)
- [ ] 회원가입 기능 (이름, 비밀번호)
- [ ] 로그인 기능 (이름, 비밀번호)
- [ ] 로그아웃 기능
- [ ] 메인 화면 UI
- [ ] 난이도 3단계 선택 (쉬움/보통/어려움)
- [ ] 곱셈 문제 랜덤 생성 (선택된 난이도에 따라)
- [ ] 물방울 낙하 애니메이션 (중력 효과)
- [ ] 숫자 입력 UI (버튼 방식)
- [ ] 정답/오답 판정 및 피드백
- [ ] 생명력 시스템 (3개)
- [ ] 점수 시스템
- [ ] 게임 오버 처리
- [ ] 최고 점수 저장 (Supabase DB)

### 4.2 추가 기능 (Phase 2)
- [ ] 커스텀 난이도 (단수 선택)
- [ ] 사운드 효과 (정답/오답/게임오버)
- [ ] 배경 음악 (on/off 가능)
- [ ] 연속 정답 보너스 시스템
- [ ] 특수 효과 (폭탄 - 모든 물방울 제거, 시간 느리게 등)
- [ ] 캐릭터 선택 기능
- [ ] 일일 챌린지 모드

### 4.3 멀티플레이어 기능 (Phase 3)
- [ ] 방 생성 기능 (고유 방 코드 생성)
- [ ] 방 코드 입력을 통한 참여 기능
- [ ] 실시간 멀티플레이어 동기화 (Supabase Realtime)
- [ ] 방별 게임 상태 관리 (대기/진행중/종료)
- [ ] 참여자 목록 및 실시간 점수 표시
- [ ] 방별 게임 결과 저장
- [ ] 방 자동 삭제 (게임 종료 후 24시간 또는 수동 삭제)

### 4.4 리더보드 기능 (Phase 3)
- [ ] 전체 리더보드 (누적 점수 기준)
- [ ] 주간 리더보드 (최근 7일 점수 기준)
- [ ] 월간 리더보드 (최근 30일 점수 기준)
- [ ] 개인 최고 기록 표시
- [ ] 리더보드 자동 갱신

### 4.5 향후 고려 기능 (Phase 4)
- [ ] 학습 통계 대시보드
- [ ] 업적 시스템
- [ ] 학부모 모니터링 기능
- [ ] 채팅 기능 (멀티플레이어 방 내)
- [ ] 친구 추가 기능

---

## 5. 기술 요구사항

### 5.1 플랫폼
- 웹 기반 (브라우저에서 실행)
- 반응형 디자인 (PC, 태블릿, 모바일 지원)

### 5.2 기술 스택
- **Frontend**: React 18, TypeScript
- **빌드 도구**: Vite
- **Canvas API**: 물방울 애니메이션 구현
- **Backend & Database**: Supabase
  - PostgreSQL 데이터베이스
  - Supabase Auth (사용자 인증 - 닉네임/비밀번호 기반)
  - Realtime 구독 (실시간 멀티플레이어 동기화)
  - Row Level Security (RLS) 정책
  - REST API 및 자동 생성 API
- **배포**: Vercel
- **스토리지**: 
  - LocalStorage: 로컬 설정 저장
  - Supabase: 온라인 점수 및 방 데이터 저장
- **Audio API**: 사운드 효과 및 배경음악

### 5.3 성능 요구사항
- 페이지 로드 시간: 3초 이내
- 프레임률: 60 FPS 유지
- 입력 반응 시간: 100ms 이내

### 5.4 호환성
- Chrome, Firefox, Safari, Edge 최신 버전
- 모바일 브라우저 (iOS Safari, Chrome Mobile)
- 최소 화면 해상도: 320px × 480px

---

## 6. UI/UX 디자인 가이드라인

### 6.1 디자인 원칙
- **명확성**: 초등학교 2학년이 직관적으로 이해할 수 있는 UI
- **밝고 친근함**: 파스텔톤 색상, 귀여운 캐릭터 요소
- **큰 터치 영역**: 손가락으로 쉽게 누를 수 있는 버튼 크기 (최소 44x44px)
- **즉각적 피드백**: 정답/오답 시 시각적/청각적 피드백

### 6.2 색상 팔레트
- 주 색상: 하늘색 (#87CEEB), 연한 파란색
- 보조 색상: 노란색 (#FFD700 - 정답), 빨간색 (#FF6B6B - 오답)
- 배경: 밝은 그라데이션 (하늘에서 구름까지)
- 텍스트: 진한 남색 (#2C3E50)

### 6.3 타이포그래피
- 제목: 24-32px, 굵게, 둥근 고딕체
- 게임 내 숫자: 20-28px, 굵게, 가독성 높은 폰트
- 버튼 텍스트: 18-22px, 중간 굵기

### 6.4 애니메이션
- 물방울 떨어지는 효과: 부드러운 가속 (ease-in)
- 정답 시: 파티클 효과, 물방울 터짐
- 오답 시: 흔들림 효과, 경고 색상 깜빡임
- 레벨업/보너스: 별 반짝임, 점수 튀어오름

---

## 7. 사용자 플로우

### 7.1 회원가입/로그인 플로우
```
[시작]
  → 메인 화면
  → [회원가입] 클릭
  → 회원가입 화면
    - 이름(닉네임) 입력
    - 비밀번호 입력
    - 비밀번호 확인 입력
  → [회원가입] 클릭
  → 자동 로그인 및 메인 화면으로 복귀

또는

  → 메인 화면
  → [로그인] 클릭
  → 로그인 화면
    - 이름(닉네임) 입력
    - 비밀번호 입력
  → [로그인] 클릭
  → 메인 화면으로 복귀 (로그인 상태)
```

### 7.2 싱글 플레이어 플로우
```
[시작] 
  → 메인 화면 (로그인 상태)
  → [시작하기] 클릭
  → 난이도 선택
  → 게임 시작
  → 게임 플레이 (반복)
    - 문제 확인
    - 답 입력
    - 정답/오답 판정
    - 다음 문제 또는 생명력 감소
  → 게임 오버 (생명력 0)
  → 결과 화면 (점수 저장 - Supabase DB)
  → [다시하기] or [메인으로]
```

### 7.3 리더보드 확인 플로우
```
[시작]
  → 메인 화면
  → [리더보드] 버튼 클릭
  → 리더보드 화면
    - [전체] / [주간] / [월간] 탭 선택
    - 상위 10명 확인
    - 개인 최고 기록 확인
  → [뒤로가기] 클릭
  → 메인 화면으로 복귀
```

### 7.4 멀티플레이어 플로우
```
[시작]
  → 메인 화면
  → [멀티플레이어] 클릭
  → [방 만들기] 또는 [방 참여하기]
  
[방 만들기]
  → 방 생성 (방 코드 자동 생성)
  → 방 코드 공유 (다른 사용자에게 전달)
  → 참여자 대기 화면
  → [게임 시작] 클릭 (방장만 가능)
  → 게임 플레이 (모든 참여자 동시 진행)
  → 게임 오버 (모든 참여자 생명력 소진 시)
  → 방별 결과 화면 (참여자별 점수 및 순위)
  → [메인으로] or [같은 방에서 다시하기]

[방 참여하기]
  → 방 코드 입력
  → 방 입장 (방이 존재하고 게임 진행 중이 아닐 때만)
  → 참여자 대기 화면
  → 방장이 게임 시작할 때까지 대기
  → 게임 플레이 및 결과 (위와 동일)
```

---

## 8. 성공 지표 (KPI)

### 8.1 사용자 참여
- 일일 활성 사용자 (DAU)
- 평균 게임 플레이 시간: 10분 이상
- 재방문율: 주간 70% 이상

### 8.2 학습 효과
- 평균 정답률: 75% 이상
- 사용자당 평균 플레이 횟수: 주간 5회 이상
- 난이도 상향 전환율: 30% 이상

### 8.3 만족도
- 사용자 리뷰 평점: 4.5/5.0 이상
- 학부모 만족도 설문: 80% 이상

---

## 9. 개발 일정

### Phase 1: MVP (4주)
- Week 1: 기획 확정, 디자인 시안, 기술 검증
- Week 2: 핵심 게임 로직 개발 (문제 생성, 낙하, 정답 판정)
- Week 3: UI 구현, 점수/생명 시스템
- Week 4: 테스트, 버그 수정, 배포

### Phase 2: 기능 확장 (3주)
- Week 5-6: 추가 기능 개발 (사운드, 커스텀 모드, 특수 효과)
- Week 7: 사용자 테스트 및 피드백 반영

### Phase 3: 멀티플레이어 및 백엔드 구축 (4주)
- Week 8: Supabase 프로젝트 설정 및 DB 스키마 설계
- Week 9: 백엔드 API 개발 (방 생성/참여/삭제, 점수 저장)
- Week 10: 실시간 동기화 구현 (Supabase Realtime)
- Week 11: 멀티플레이어 UI 구현 및 테스트

### Phase 4: 리더보드 및 배포 (2주)
- Week 12: 리더보드 기능 개발 (전체/주간/월간)
- Week 13: Vercel 배포 설정 및 최종 테스트

### Phase 5: 고도화 (지속적)
- 사용자 피드백 기반 개선
- 통계 기능 추가
- 성능 최적화
- 추가 기능 개발

---

## 10. 위험 요소 및 대응 방안

### 10.1 위험 요소
- **난이도 밸런싱**: 너무 쉽거나 어려워 흥미 상실
- **주의 지속 시간**: 7-8세 아동의 짧은 집중력
- **기술적 문제**: 모바일 성능 이슈, 브라우저 호환성

### 10.2 대응 방안
- 실제 타겟 사용자 그룹 테스트 진행 (최소 20명)
- 게임 플레이 시간을 5-10분으로 제한하고 짧은 세션 권장
- 다양한 디바이스 및 브라우저에서 철저한 테스트
- 성능 모니터링 도구 적용

---

## 11. 부록

### 11.1 문제 출제 규칙
- 같은 문제 연속 출제 방지 (최근 5문제 중복 체크)
- 단수별 균등 분배 (선택된 단수 범위 내)
- 순서 무작위 (2×3, 3×2 모두 가능)

### 11.2 접근성 고려사항
- 색맹 사용자를 위한 색상 + 아이콘 병행 사용
- 키보드 입력 지원 (숫자 키)
- 음성 피드백 옵션 (선택사항)

### 11.3 데이터베이스 스키마 설계

#### 11.3.1 테이블 구조

**users (사용자 테이블)**
```sql
- id: uuid (PK, Supabase Auth의 user.id와 연결)
- nickname: text (UNIQUE, 사용자 닉네임/이름)
- created_at: timestamp
- updated_at: timestamp
- best_score: integer (최고 점수, 기본값: 0)
```

**참고**: Supabase Auth를 사용하여 사용자 인증 처리
- 이메일/비밀번호 대신 닉네임/비밀번호로 인증
- 또는 Supabase Auth의 커스텀 인증 방식 활용

**rooms (방 테이블)**
```sql
- id: uuid (PK)
- room_code: text (UNIQUE, 6자리 영숫자)
- host_id: uuid (FK -> users.id, 방장)
- difficulty: text (쉬움/보통/어려움/커스텀)
- custom_tables: integer[] (커스텀 모드일 경우 선택된 단수 배열)
- status: text (waiting/playing/finished)
- max_players: integer (기본값: 10)
- created_at: timestamp
- finished_at: timestamp
```

**room_participants (방 참여자 테이블)**
```sql
- id: uuid (PK)
- room_id: uuid (FK -> rooms.id)
- user_id: uuid (FK -> users.id)
- joined_at: timestamp
- UNIQUE(room_id, user_id)
```

**game_sessions (게임 세션 테이블)**
```sql
- id: uuid (PK)
- room_id: uuid (FK -> rooms.id, NULL 가능 - 싱글플레이)
- user_id: uuid (FK -> users.id)
- score: integer
- correct_count: integer (맞춘 문제 수)
- total_count: integer (전체 문제 수)
- accuracy: float (정답률)
- difficulty: text
- played_at: timestamp
```

**leaderboard (리더보드 캐시 테이블 - 선택사항)**
```sql
- id: uuid (PK)
- user_id: uuid (FK -> users.id)
- total_score: integer (누적 점수)
- weekly_score: integer (주간 점수)
- monthly_score: integer (월간 점수)
- best_score: integer (최고 점수)
- updated_at: timestamp
```

#### 11.3.2 Row Level Security (RLS) 정책
- **users**: 
  - 자신의 정보 읽기/수정 가능
  - 다른 사용자 정보는 읽기만 가능 (닉네임, 최고 점수 등)
  - 회원가입 시 자신의 레코드만 생성 가능
- **rooms**: 모든 사용자가 방 목록 조회 가능, 방 생성자는 자신의 방 수정/삭제 가능
- **room_participants**: 방 참여자는 자신의 참여 정보 조회 가능, 방장은 방의 모든 참여자 조회 가능
- **game_sessions**: 모든 사용자가 게임 세션 조회 가능, 자신의 세션만 생성 가능
- **leaderboard**: 모든 사용자가 리더보드 조회 가능, 수정 불가

#### 11.3.3 인증 시스템 설계
- **회원가입**: 
  - 닉네임 중복 체크 (UNIQUE 제약조건)
  - 비밀번호 최소 6자 이상
  - Supabase Auth를 통한 사용자 생성
- **로그인**: 
  - 닉네임과 비밀번호로 인증
  - 세션 유지 (Supabase Auth 세션)
- **로그아웃**: 
  - Supabase Auth 세션 종료

#### 11.3.4 API 엔드포인트 설계

**인증**
- `POST /api/auth/signup` - 회원가입 (닉네임, 비밀번호)
- `POST /api/auth/login` - 로그인 (닉네임, 비밀번호)
- `POST /api/auth/logout` - 로그아웃
- `GET /api/auth/me` - 현재 로그인된 사용자 정보 조회

**방 관리**
- `POST /api/rooms` - 방 생성
- `GET /api/rooms/:room_code` - 방 정보 조회
- `POST /api/rooms/:room_code/join` - 방 참여
- `DELETE /api/rooms/:room_id` - 방 삭제 (방장만)
- `POST /api/rooms/:room_id/start` - 게임 시작 (방장만)

**게임 세션**
- `POST /api/game-sessions` - 게임 결과 저장
- `GET /api/game-sessions?room_id=:id` - 방별 게임 결과 조회
- `GET /api/game-sessions?user_id=:id` - 사용자별 게임 기록 조회

**리더보드**
- `GET /api/leaderboard/total` - 전체 리더보드
- `GET /api/leaderboard/weekly` - 주간 리더보드
- `GET /api/leaderboard/monthly` - 월간 리더보드

**실시간 구독**
- `rooms:room_id` - 방 상태 변경 구독
- `room_participants:room_id` - 방 참여자 변경 구독
- `game_sessions:room_id` - 게임 진행 상황 구독

### 11.4 배포 구조

**Vercel 배포 설정**
- Frontend: Vercel에 React 앱 배포
- Environment Variables:
  - `VITE_SUPABASE_URL`: Supabase 프로젝트 URL
  - `VITE_SUPABASE_ANON_KEY`: Supabase 익명 키
- Build Command: `npm run build`
- Output Directory: `dist`

**Supabase 설정**
- 프로젝트 생성 및 데이터베이스 초기화
- 테이블 생성 및 RLS 정책 설정
- Realtime 기능 활성화 (rooms, room_participants, game_sessions 테이블)

### 11.5 참고 자료
- 초등학교 2학년 수학 교육과정 기준
- 게임화 학습(Gamification) 모범 사례
- 아동 UI/UX 디자인 가이드라인
- Supabase 공식 문서: https://supabase.com/docs
- Vercel 배포 가이드: https://vercel.com/docs

---

## 12. 승인 및 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0  | 2025-11-06 | - | 초안 작성 |
| 2.0  | 2025-01-XX | - | 멀티플레이어 기능, Supabase 백엔드, Vercel 배포, 리더보드 기능 추가 |

---

**문의 및 피드백**: 본 PRD에 대한 의견이나 제안사항이 있으시면 언제든지 연락 주시기 바랍니다.

